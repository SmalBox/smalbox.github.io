<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Minima -->
  <!-- Hexo theme created by @adisaktijrs -->

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">

  
  <title>安装Gitment及常见问题解决</title>
  
  <link rel="canonical" href="https://autozcy.gitee.io/2018/10/24/an-zhuang-gitment-ji-chang-jian-wen-ti-jie-jue/">
  
  <meta name="description" content="安装Gitment评论模块 &amp;amp; 常见问题解决前言本文记录了本博客添加gitment评论模块的过程，并对配置过程中碰到的问题与其解决方案作出阐述。因每个hexo选择的主题不一样，所以主题的文件结构会有所不同，具体操作也会有所不同，所以本文也尽可能的写出配置思路，来帮助不同主题的hexo博主配置">
  
  
  <meta name="author" content="SmalBox">
  
  <meta property="og:image" content="https://autozcy.gitee.ioundefined">
  
  <meta property="og:site_name" content="SmalBoxBlog" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="安装Gitment及常见问题解决" />
  
  <meta property="og:description" content="安装Gitment评论模块 &amp;amp; 常见问题解决前言本文记录了本博客添加gitment评论模块的过程，并对配置过程中碰到的问题与其解决方案作出阐述。因每个hexo选择的主题不一样，所以主题的文件结构会有所不同，具体操作也会有所不同，所以本文也尽可能的写出配置思路，来帮助不同主题的hexo博主配置">
  
  <meta property="og:url" content="https://autozcy.gitee.io/2018/10/24/an-zhuang-gitment-ji-chang-jian-wen-ti-jie-jue/" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="安装Gitment及常见问题解决">
  
  <meta name="twitter:description" content="安装Gitment评论模块 &amp;amp; 常见问题解决前言本文记录了本博客添加gitment评论模块的过程，并对配置过程中碰到的问题与其解决方案作出阐述。因每个hexo选择的主题不一样，所以主题的文件结构会有所不同，具体操作也会有所不同，所以本文也尽可能的写出配置思路，来帮助不同主题的hexo博主配置">
  
  
  <meta name="twitter:image" content="https://autozcy.gitee.ioundefined">
  
  <meta name="twitter:url" content="https://autozcy.gitee.io/2018/10/24/an-zhuang-gitment-ji-chang-jian-wen-ti-jie-jue/" />

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Preload fonts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="preload" href="../fonts/dm-serif-display-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="../fonts/inter-v2-latin-regular.woff2" as="font" type="font/woff2" crossorigin>

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  
<link rel="stylesheet" href="/css/normalize.css">

  
<link rel="stylesheet" href="/css/skeleton.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
<link rel="stylesheet" href="/css/prism-dark.css">

  
<link rel="stylesheet" href="/css/prism-line-numbers.css">

  <!-- User css -->
  
  
<link rel="stylesheet" href="/css/user.css">

  

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="/images/favicon.png">

  <!-- Custom Theme Color Style
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <style>
  a:not(.icon) {
    text-decoration-color: #0FA0CE;
    background-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 50%,
      #0FA0CE 50%
    );
  }
  blockquote {
    border-left: 8px solid #0FA0CE;
  }
  .nanobar .bar {
    background: #0FA0CE;
  }
  .button.button-primary:hover,
  button.button-primary:hover,
  input[type="submit"].button-primary:hover,
  input[type="reset"].button-primary:hover,
  input[type="button"].button-primary:hover,
  .button.button-primary:focus,
  button.button-primary:focus,
  input[type="submit"].button-primary:focus,
  input[type="reset"].button-primary:focus,
  input[type="button"].button-primary:focus {
    background-color: #0FA0CE;
    border-color: #0FA0CE;
  }
  input[type="email"]:focus,
  input[type="number"]:focus,
  input[type="search"]:focus,
  input[type="text"]:focus,
  input[type="tel"]:focus,
  input[type="url"]:focus,
  input[type="password"]:focus,
  textarea:focus,
  select:focus {
    border: 1px solid #0FA0CE;
  }
</style>

  <!-- Google Analytics (With Privacy Settings On)
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div class="container">
    <div class="row">
      <div>

        <div class="row">
  <div class="two columns" style="max-width: 50px">
    <h1 class="mt-2 mode">
      <div onclick=setDarkMode(true) id="darkBtn">🌑</div>
      <div onclick=setDarkMode(false) id="lightBtn" class=hidden>☀️</div>
      <script >
        if (localStorage.getItem('preferredTheme') == 'dark') {
          setDarkMode(true)
        }
        function setDarkMode(isDark) {
          var darkBtn = document.getElementById('darkBtn')
          var lightBtn = document.getElementById('lightBtn')
          if (isDark) {
            lightBtn.style.display = "block"
            darkBtn.style.display = "none"
            localStorage.setItem('preferredTheme', 'dark');
          } else {
            lightBtn.style.display = "none"
            darkBtn.style.display = "block"
            localStorage.removeItem('preferredTheme');
          }
          document.body.classList.toggle("darkmode");
        }
      </script>
    </h1>
  </div>

  <div class="six columns ml-1">
    <h1 class="mt-2">
      脑洞杂货铺
    </h1>
  </div>

  <div class="twelve columns">
    <div class="row">
      <div class="nine columns left">
        <a href="/">Home</a>
        
          
          <a href="/archives" class="ml">Archives</a>
          
        
        
          
            <a href="mailto:smal_box@163.com" target="_blank" class="ml">Email</a>
          
        
      </div>
    </div>
    <hr style="margin-bottom: 2.6rem">
  </div>
</div>

        <div class="trans">
            <h2>安装Gitment及常见问题解决</h2>

  <h1 id="安装Gitment评论模块-amp-常见问题解决"><a href="#安装Gitment评论模块-amp-常见问题解决" class="headerlink" title="安装Gitment评论模块 &amp; 常见问题解决"></a>安装Gitment评论模块 &amp; 常见问题解决</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h2><p>本文记录了本博客添加gitment评论模块的过程，并对配置过程中碰到的问题与其解决方案作出阐述。<br>因每个hexo选择的主题不一样，所以主题的文件结构会有所不同，具体操作也会有所不同，所以本文也尽可能的写出配置思路，来帮助不同主题的hexo博主配置自己主题的gitment评论模块。</p>
<p>对gitment的介绍就不多说了，就是利用GitHub的issue来做评论，能同步issue里的留言。具体详细可以去看项目介绍：<a target="_blank" rel="noopener" href="https://github.com/imsun/gitment">Gitment项目地址</a>.</p>
<blockquote>
<p>大致描述一下gitment的配置：</p>
</blockquote>
<ul>
<li><p>首先是两个配置文件，一个css文件一个js文件。gitment的开发者用远程连接的方式将两个文件引入hexo中。但是实际操作中会遇到问题（最后常见问题中会写解决方案），其中的js文件中需要访问作者自己搭建的服务器，但是现在作者的服务器不好使了，会导致全都配置好了，但是报错。所以要下载到本地的自己项目中，然后在项目中自己引用这两个文件（具体操作本文安装部分会写到）。</p>
</li>
<li><p>其次就是由于主题不同，有的主题的作者在开始设计主题的时候就为用户写好了gitment的配置代码，只需用户在主题的_config.yml中开启并填写好配置参数即可。有的主题没有预制好gitment的配置代码，就需要用户自己去在样式模板中添加gitment代码。</p>
</li>
</ul>
<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a><strong>概览</strong></h2><ol>
<li>安装gitment到主题</li>
<li>注册OAuth application</li>
<li>配置gitment到hexo主题中</li>
<li>初始化评论</li>
<li>常见问题解决</li>
</ol>
<h3 id="1-安装gitment到主题"><a href="#1-安装gitment到主题" class="headerlink" title="1.安装gitment到主题"></a><strong>1.安装gitment到主题</strong></h3><p>由于有的hexo主题预置gitment模块，有的没有，所以分两种情况来说。</p>
<ol>
<li><strong>主题已经集成了gitment模块 看这里～</strong></li>
</ol>
<ul>
<li>需要博主自己查看一下自己的主题结构，找到 <strong>themes</strong> 下的 <strong>_config.yml</strong> 文件，在文件中找到gitment模块的相关参数，然后在 <strong>enable</strong> 选项后面写上 <strong>true</strong> 即可完成安装过程。</li>
</ul>
<p>  如图所示： <img src="/2018/10/24/an-zhuang-gitment-ji-chang-jian-wen-ti-jie-jue/gitmentConfig.png" alt="gitmentConfig"></p>
<ol start="2">
<li><strong>主题没有集成gitment模块 根本配置在这里～</strong></li>
</ol>
<ul>
<li>如果在自己的 <strong>themes</strong> 的 <strong>_config.yml</strong> 中没有看到 <strong>gitment</strong>相关选项，就要自己配置。</li>
<li>这时就要用到gitment作者的安装方法了。前言中说到的两个文件一个css一个js，只要将这两个文件引入自己主题的母板中就完成了安装。由于作者的提供是js文件中需要改动，所以这里要将提供是文件下载下来到自己的博客中，根据自己的文件结构防治css和js文件。然后在模板文件中引用两个文件。</li>
<li><a target="_blank" rel="noopener" href="https://imsun.github.io/gitment/style/default.css">css文件下载地址</a></li>
<li><a target="_blank" rel="noopener" href="https://imsun.github.io/gitment/dist/gitment.browser.js">js文件下载地址</a></li>
</ul>
  <pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--(将以下添加到模板文件中（这个引用路径是一个例子，根据自己的目录引用)--></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/libs/gitment/default.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/libs/gitment/gitment.browser.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><em>（注：本质上安装就是在主题模板文件中引入一个css和一个js文件。集成gitment模块的主题只不过是做到了代码分离，让需要配置的参数在_config.yml中统一配置。gitment作者给出的方法是在给没有集成的主题中的根本引入办法。如果你能看懂主题作者的组织结构，那完全可以给自己的主题集成gitment模块。因主题结构不一样我就不详细举例了。）</em></p>
<h3 id="2-注册OAuth-application"><a href="#2-注册OAuth-application" class="headerlink" title="2.注册OAuth application"></a><strong>2.注册OAuth application</strong></h3><p>因为gitment是利用了github的issue，所以要注册OAuth application，来获取配置参数为接下来的配置做准备。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/settings/applications/new">点击此处</a>来注册，一个新的 OAuth Application。其他内容可以随意填写，但要确保填入正确的 callback URL（一般是评论页面对应的域名，如 <a target="_blank" rel="noopener" href="https://smalbox.top)./">https://smalbox.top）。</a></p>
<p>注册后会给两个字符串 <strong>Client ID</strong> 和 <strong>Client Secret</strong> , 这两个下面配置的时候要用。</p>
<h3 id="3-配置Gitment到hexo主题中"><a href="#3-配置Gitment到hexo主题中" class="headerlink" title="3.配置Gitment到hexo主题中"></a><strong>3.配置Gitment到hexo主题中</strong></h3><p>同样的，也是一种预置gitment和自己配置分两种来说。</p>
<ol>
<li><strong>主题已经集成了gitment模块 看这里～</strong> </li>
</ol>
<ul>
<li>只需在 <strong>_config.yml</strong> 中找到刚才开启gitment的那里，下面有四个参数要添加。</li>
</ul>
<p>  如图所示：<img src="/2018/10/24/an-zhuang-gitment-ji-chang-jian-wen-ti-jie-jue/gitmentConfiged.jpeg" alt="gitmentConfiged"></p>
<ol start="2">
<li><strong>主题没有集成gitment模块 根本配置在这里～</strong></li>
</ol>
<ul>
<li>在刚才添加的母版中继续添加如下代码：</li>
</ul>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">var</span> gitment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gitment</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  owner<span class="token operator">:</span> <span class="token string">'你的 GitHub ID'</span><span class="token punctuation">,</span>
  repo<span class="token operator">:</span> <span class="token string">'存储评论的 repo'</span><span class="token punctuation">,</span>
  oauth<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    client_id<span class="token operator">:</span> <span class="token string">'你的 client ID'</span><span class="token punctuation">,</span>
    client_secret<span class="token operator">:</span> <span class="token string">'你的 client secret'</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
gitment<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>将以上的代码中的四个参数按照提示填好即可。</li>
</ul>
<h3 id="4-初始化评论"><a href="#4-初始化评论" class="headerlink" title="4.初始化评论"></a><strong>4.初始化评论</strong></h3><p>理论上按照以上配置完发布即可看到评论区了。只不过每一个帖子下面的评论区都要初始化才能开始评论。</p>
<p>根据gitment作者的说法，只要到用博主的github账号登录后点击初始化就可以使用了。</p>
<h3 id="5-常见问题解决"><a href="#5-常见问题解决" class="headerlink" title="5.常见问题解决"></a><strong>5.常见问题解决</strong></h3><ul>
<li>评论点击登录，登录GitHub之后跳转回来的时候不能正常跳回刚才贴纸那页。每次跳到主页。</li>
</ul>
<p><strong>解决办法：</strong> 在注册OAuth application时的回调地址有问题，尝试写绑定的域名，而不是用 “https://用户名.github.io”</p>
<ul>
<li>报错 “[object ProgressEvent]”</li>
</ul>
<p><strong>原因：</strong> 在母版中调用的js文件中，有访问gitment作者的服务器代码，而作者的服务器不好使了。</p>
<p><strong>解决办法：</strong> 自己搭建一个服务器（需要有一个vps来辅助搭建服务器，当然下面我也会提供一个我搭建好的服务器）</p>
<ol>
<li>在服务器中clone作者的服务器源码</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/SmalBox/gh-oauth-server.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>进入项目，下载依赖，并启动</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> <span class="token function">nohup</span> <span class="token function">npm</span> start <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><em>(注：如果运行失败，可能是nodejs没有安装好，请安装nodejs。然后再重新运行命令,如果成功,在项目目录下的nohup.out文件中的最后，会提示正在监听3000端口。这里需要用nginx将证书搞定，用https访问，否则默认http还是会报错。证书的问题我就不啰嗦了，证书参考<a target="_blank" rel="noopener" href="https://www.bugprogrammer.me/2018/05/19/phpnginxmysql.html#more">这个帖子的 11.后续优化 部分</a>,端口转发请参考<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002797606">这个帖子</a>)</em></p>
<ol start="3">
<li>替换js文件中的作者服务器为自己服务器</li>
</ol>
<p>在作者的js文件中搜索以下字符串：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">https://gh-oauth.imsun.net<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将其替换成刚才搭建服务器的地址即可。</p>
<p><strong>OK大功告成，可以去测试一下了。可以在本站的下面回复评论测试。</strong></p>
<p><strong>如果有任何问题，可以在下面评论或者通过邮件联系我。</strong></p>

  <p><a class="classtest-link" href="/tags/Gitment/" rel="tag">Gitment</a> — 2018年10月24日</p>
  


          <div class="row mt-2">
  
    <div class="eight columns">
      <p id="madewith">Made with 
        <a href="https://github.com/smalbox" target="_blank">SmalBox</a>
         and
        <a class="footer-link icon" href="https://hexo.io" target="_blank" style="text-decoration: none;" rel="noreferrer" aria-label="Hexo.io">
        <svg class="hexo svg-hov" width="14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Hexo.js</title><path d="M12 .007L1.57 6.056V18.05L12 23.995l10.43-6.049V5.952L12 .007zm4.798 17.105l-.939.521-.939-.521V12.94H9.08v4.172l-.94.521-.938-.521V6.89l.939-.521.939.521v4.172h5.84V6.89l.94-.521.938.521v10.222z"/></svg>
        </a>
        
        at <a href="https://en.wikipedia.org/wiki/Earth" target="_blank" rel="noreferrer">Earth</a>.</p>
        
    </div>

    <!-- Sepcial thanks to https://simpleicons.org/ for the icons -->
    <div class="four columns mb-3 posisi" >
      
      <a class="ml-0 footer-link icon" href="https://github.com/smalbox" target="_blank" style="text-decoration: none" rel="noreferrer" aria-label="GitHub">
        <svg class="github svg-hov" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
      </a>
      

      

      

      

      

    </div>
  
</div>

        </div>
      </div>

    </div>

  </div>
  <script src="/js/nanobar.min.js"></script>
  <script>
    var options = {
      classname: 'nanobar',
      id: 'myNanobar'
    };
    var nanobar = new Nanobar(options);
    nanobar.go(30);
    nanobar.go(76);
    nanobar.go(100);
  </script>

</body>

</html>
